#!/bin/bash

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é Card Checker Bot –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."

cd /workspace

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –±–æ—Ç
if pgrep -f "python3 bot.py" > /dev/null; then
    echo "‚ö†Ô∏è  –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω!"
    echo "–î–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ: ./stop_bot.sh"
    exit 1
fi

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ
nohup python3 bot.py > bot.log 2>&1 &

# –ü–æ–ª—É—á–∏—Ç—å PID
BOT_PID=$!

echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!"
echo "üìã PID: $BOT_PID"
echo "üìÑ –õ–æ–≥–∏: /workspace/bot.log"
echo ""
echo "–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
echo "  tail -f /workspace/bot.log"
echo ""
echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞:"
echo "  ./stop_bot.sh"

# –ñ–¥–µ–º —Å–µ–∫—É–Ω–¥—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
sleep 2

if pgrep -f "python3 bot.py" > /dev/null; then
    echo ""
    echo "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!"
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ bot.log"
fi
